

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Chapter 13: Hello charts &mdash; First Python Notebook 1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="About the authors" href="../about/index.html" />
    <link rel="prev" title="Chapter 12: Hello remix" href="../remix/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> First Python Notebook
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../prerequisites/index.html">Prologue: Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipenv/index.html">Chapter 1: Hello pipenv</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebook/index.html">Chapter 2: Hello notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pandas/index.html">Chapter 3: Hello pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../money/index.html">Chapter 4: Hello money in politics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataframe/index.html">Chapter 5: Hello data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../value_counts/index.html">Chapter 6: Hello columns</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filter/index.html">Chapter 7: Hello filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../merge/index.html">Chapter 8: Hello merge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../totals/index.html">Chapter 9: Hello totals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sort_values/index.html">Chapter 10: Hello sorting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../groupby/index.html">Chapter 11: Hello groupby</a></li>
<li class="toctree-l1"><a class="reference internal" href="../remix/index.html">Chapter 12: Hello remix</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Chapter 13: Hello charts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About the authors</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">First Python Notebook</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          









<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Home</a> &raquo;</li>
        
      
      <li>Chapter 13: Hello charts</li>
      
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="chapter-13-hello-charts">
<h1>Chapter 13: Hello charts<a class="headerlink" href="#chapter-13-hello-charts" title="Permalink to this headline">¶</a></h1>
<p>Python has a number of charting tools that can work hand-in-hand with pandas. <a class="reference external" href="https://altair-viz.github.io/">Altair</a> is a relative newbie, but it’s got good documentation and can display charts right in your Jupyter Notebook — plus it can export to lots of other formats.</p>
<p>Let’s take it for a spin.</p>
<p>Before we start, we need to make sure it is installed. Head back to your terminal and practice that pipenv install process.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pipenv install altair
</pre></div>
</div>
<p>After that completes, once again restart your notebook.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pipenv run jupyter notebook
</pre></div>
</div>
<p>Now you can head back to your notebook and add Altair to your imports. We’ll usually import it with the alias <code class="docutils literal notranslate"><span class="pre">alt</span></code> so we don’t have to type out the whole thing every time we make a chart.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
</pre></div>
</div>
<p>Now rerun the entire notebook, as we learned above. You will need to do this when you halt and restart your notebook on the command line. Reminder, you can do this by pulling down the <code class="docutils literal notranslate"><span class="pre">Cell</span></code> menu at the top of the notebook and selecting the <code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">all</span></code> option.</p>
<p>Let’s pick up where we last left off in <span class="xref std std-doc">the previous chapter</span>. If we want to chart out how much the top supporters of the proposition spent, we first need to select them from the dataset. Using the grouping and sorting tricks we learned earlier, the top 10 can returned like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">top_supporters</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;contributor_firstname&quot;</span><span class="p">,</span> <span class="s2">&quot;contributor_lastname&quot;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>We can then view them with a trick you may remember by now.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">top_supporters</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/top_supporters_df.png" src="../_images/top_supporters_df.png" />
<p>Now that we have <code class="docutils literal notranslate"><span class="pre">altair</span></code> imported, we can pop that dataframe into a quick chart. Let’s step through the building blocks of a chart.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">top_supporters</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;contributor_lastname&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;amount&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/bar_vertical.png" src="../_images/bar_vertical.png" />
<p>Look at that chart!</p>
<p>Here’s an idea — maybe we want to do horizontal, not vertical bars. How would you rewrite this chart code to reverse those bars?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">top_supporters</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;contributor_lastname&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/bar_horizontal.png" src="../_images/bar_horizontal.png" />
<p>What if we wanted to focus on the top five records? We can use that <code class="docutils literal notranslate"><span class="pre">head</span></code> command we already know.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">top_supporters</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;contributor_lastname&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/bar_head.png" src="../_images/bar_head.png" />
<p>Okay, but what if I want to combine the first and last name? We have the data we need in two separate columns, which we can put together simply by inventing a new field on our data frame and, just like a variable, setting it equal to a combination of the other fields.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">top_supporters</span><span class="p">[</span><span class="s1">&#39;contributor_fullname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_supporters</span><span class="o">.</span><span class="n">contributor_firstname</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">top_supporters</span><span class="o">.</span><span class="n">contributor_lastname</span>
</pre></div>
</div>
<p>Now we can use that column instead of``contributor_lastname`` in our chart.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">top_supporters</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;contributor_fullname&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/bar_fullname.png" src="../_images/bar_fullname.png" />
<p>Notice how the sort order changed when we changed the contributor column? This chart is sorted alphabetically by y-axis value, and it’s making everything look pretty sloppy and hard to parse. Let’s fix that.</p>
<p>We want to sort the y-axis values by their corresponding x values. We’ve been using the shorthand syntax to pass in our axis columns so far, but to add more customization to our chart we’ll have to switch to the longform way of defining the y axis.</p>
<p>That will look something like the way we define the chart in the first place: <code class="docutils literal notranslate"><span class="pre">alt.Y(column_name,</span> <span class="pre">arg=&quot;value&quot;)</span></code>. There are lots of options that you might want to pass in, like ones that will sum your data on the fly or define the number range you want your axis to display. In this case, we’ll just be using the <code class="docutils literal notranslate"><span class="pre">sort</span></code> command.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">top_supporters</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;contributor_fullname&quot;</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="s2">&quot;-x&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/bar_sort.png" src="../_images/bar_sort.png" />
<p>And we can’t have a chart without context. Let’s throw in a title for good measure.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">top_supporters</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;contributor_fullname&quot;</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="s2">&quot;-x&quot;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Top Spenders in Support of Proposition 64&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/bar_title.png" src="../_images/bar_title.png" />
<p>Yay, we made a chart!</p>
<p>Now, we have a good idea of who spent the most in support of Prop. 64. What if we wanted to see who spent money on both sides?</p>
<p>Add a new cell and a new dataframe, <code class="docutils literal notranslate"><span class="pre">top_contributors</span></code>, summing up the top contributors in our whole <code class="docutils literal notranslate"><span class="pre">merged</span></code> dataframe. We’re going to repeat a lot of the pandas functions we’ve stepped through before, all in one go this time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">top_contributors</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;contributor_firstname&quot;</span><span class="p">,</span> <span class="s2">&quot;contributor_lastname&quot;</span><span class="p">,</span><span class="s2">&quot;committee_position&quot;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>And once again, we’re going to want a <code class="docutils literal notranslate"><span class="pre">contributor_fullname</span></code> column that combines our first and last name columns.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">top_contributors</span><span class="p">[</span><span class="s2">&quot;contributor_fullname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_contributors</span><span class="p">[</span><span class="s2">&quot;contributor_firstname&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">top_contributors</span><span class="p">[</span><span class="s2">&quot;contributor_lastname&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Now pop <code class="docutils literal notranslate"><span class="pre">top_contributors</span></code> into a chart, just like we did before. Remember that sort function!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">top_contributors</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;contributor_fullname&quot;</span><span class="p">,</span><span class="n">sort</span><span class="o">=</span><span class="s2">&quot;-x&quot;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>What facet of the data is this chart <em>not</em> showing? How might we add additional context?</p>
<p>We have that <code class="docutils literal notranslate"><span class="pre">committee_position</span></code> column in our dataframe now. Let’s try an altair option that we haven’t used yet: color. Can you guess where we should add that in?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">top_contributors</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;contributor_fullname&quot;</span><span class="p">,</span><span class="n">sort</span><span class="o">=</span><span class="s2">&quot;-x&quot;</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;committee_position&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/bar_color.png" src="../_images/bar_color.png" />
<p>Hey now! That wasn’t too hard, was it?</p>
<p>To be fair, none of these charts are ready to pop into a news story quite yet. There <em>are</em> lots of additional formatting and design options that you can start digging into in the <a class="reference external" href="https://altair-viz.github.io/index.html">Altair docs</a> — you can even create Altair themes to specify default color schemes and fonts.</p>
<p>But you may not want to do all that tweaking in code, especially if you’re just working on a one-off graphic. If you wanted to hand this chart off to a graphics department, all you’d have to do is head to the top right corner of your chart.</p>
<p>See those three dots? Click on that, and you’ll see lots of options. Downloading the file as an SVG will let anyone with graphics software like Adobe Illustrator take this file and tweak the design.</p>
<img alt="../_images/bar_export.gif" src="../_images/bar_export.gif" />
<p>Want to recreate this chart in a tool like <a class="reference external" href="https://quartz.github.io/Chartbuilder/">Chartbuilder</a> or <a class="reference external" href="https://www.datawrapper.de/">Datawrapper</a>?  In that case, you’ll want to export this data into a spreadsheet.</p>
<p>Guess what? It’s this easy.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">top_supporters</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;top_supporters.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../about/index.html" class="btn btn-neutral float-right" title="About the authors" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../remix/index.html" class="btn btn-neutral float-left" title="Chapter 12: Hello remix" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Ben Welsh and the California Civic Data Coalition

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>